{% if medallion_layers %}
  {% for layer in medallion_layers %}
resource "azurerm_storage_account" "{{ storage_account_name | lower }}{{ layer }}" {
  name                = "{{ storage_account_name | lower }}{{ layer }}"
  resource_group_name = "{{ resource_group_name }}"
  location            = "{{ location }}"
  account_tier        = "Standard"
  account_replication_type = "LRS"
  is_hns_enabled      = {{ is_hns_enabled | default(true) | lower }}
  access_tier         = "{{ access_tier | default('Hot') }}"
  tags                = {{ dict_to_hcl(tags) }}
}

resource "azurerm_storage_data_lake_gen2_filesystem" "{{ storage_account_name | lower }}{{ layer }}_fs" {
  name               = "{{ layer }}"
  storage_account_id = azurerm_storage_account.{{ storage_account_name | lower }}{{ layer }}.id
}
  {% endfor %}
{% else %}
# No medallion layers provided; create a single storage account
resource "azurerm_storage_account" "{{ storage_account_name | lower }}" {
  name                = "{{ storage_account_name }}"
  resource_group_name = "{{ resource_group_name }}"
  location            = "{{ location }}"
  account_tier        = "Standard"
  account_replication_type = "LRS"
  is_hns_enabled      = {{ is_hns_enabled | default(true) | lower }}
  access_tier         = "{{ access_tier | default('Hot') }}"
  tags                = {{ dict_to_hcl(tags) }}
}
{% endif %}
